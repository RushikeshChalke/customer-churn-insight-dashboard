<!DOCTYPE html>
<html>
<head>
    <title>Customer Churn Insight Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {font-family: 'Segoe UI', sans-serif; background: #f4f6f9; margin:0;}
        .container {max-width: 1200px; margin: 20px auto; padding: 20px;}
        .card {background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 20px;}
        h1 {text-align:center; color:#2c3e50;}
        .grid {display: grid; grid-template-columns: 1fr 1fr; gap: 20px;}
        @media (max-width:768px) {.grid {grid-template-columns: 1fr;}}
    </style>
</head>
<body>
<div class="container">
    <h1>Customer Churn Insight Dashboard</h1>
    <div class="card grid">
        <div><canvas id="churnChart"></canvas></div>
        <div><canvas id="ageChart"></canvas></div>
    </div>
    <div class="card">
        <h3>Live Prediction API Test</h3>
        <button onclick="predict()">Predict Churn for Age=35, 12 months, â‚¹85/month</button>
        <p id="result"></p>
    </div>
</div>

<script>
async function predict() {
    const resp = await fetch("/api/predict/", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({age:35, tenure_months:12, monthly_charges:85, total_charges:1020})
    });
    const data = await resp.json();
    document.getElementById("result").innerHTML = `<strong>Churn Probability: ${(data.churn_probability*100).toFixed(1)}%</strong>`;
}
predict();

fetch('/data/customers.csv').then(r=>r.text()).then(csv=>{
    const lines = csv.split('\n').slice(1);
    const churn = lines.filter(l=>l).map(l=>l.split(',')[5]);
    const churnRate = churn.filter(c=>c=='1').length / churn.length * 100;

    new Chart(document.getElementById('churnChart'), {
        type: 'doughnut',
        data: {labels:['Loyal','Churned'], datasets:[{data:[100-churnRate, churnRate], backgroundColor:['#27ae60','#e74c3c']}]},
        options: {plugins:{title:{display:true,text:'Overall Churn Rate'}}}
    });
});
</script>
</body>
</html>
